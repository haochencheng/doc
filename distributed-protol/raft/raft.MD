##  raft
http://thesecretlivesofdata.com/
https://raft.github.io/

角色，每个节点三种角色          
```
follower 跟随者         
leader leader           
candidate 候选人   
```

### 选举超时 election timeout： 

    选举超时是指追随者成为候选人之前所等待的时间。
    leader会定时给follower发送心跳，同步日志。follower接受到leader心跳更新选举超时时间，顺延150ms~300ms。
    如果follower在选举超时时间内没有收到心跳信息。变成candidate，进行集群选举，发起投票请求。

### 集群选举 Leader Election：
    候选人发起投票，将投票请求发送给集群中其他节点。如果接收节点在这个任期中还没有投票，那么它将投票给候选人，
    并且节点重置其选举超时时间。一旦候选人获得多数票（大于集群一般的数量），便成为领导者。可以确保每个任期只能选出一位领导人。
    领导者开始向其跟随者发送“同步日志”消息，这些消息以心跳超时指定的时间间隔发送。
    跟随者然后响应每个追加条目消息。
    此选举任期将持续到追随者停止接收心跳并成为候选人为止。

### 同时发起选举：
    如果两个节点同时成为候选节点，则可能会发生同时选举。
    两个节点都开始同一任期的选举，每个都先到达一个跟随者节点。每个候选人都有2票，并且在这个任期中将无法获得更多选票。
    节点将等待新的选举，然后重试。

### 日志复制 Log Replication：
    当选出一位领导人后，我们需要将系统的所有更改复制到所有节点。
    通过使用与心跳相同的“添加条目”消息来完成此操作。
    客户端发送数据变更到leader，leader记录日志。下一个心跳leader向跟随者同步日志，半数跟随者确认提交日志。响应客户端请求

### 网络分区 network partitions：
    a,b,c,d,e 5个节点 b是 leader term 1.发生网络分区  。ab 可见，cde可见。
        ab
        ====
        cde 
    c 选举成为新leader trem 2
    现在有两个leader b1，c2.
    此时2个客户端访问 b，c A：3 B：8
    b节点无法提交日志 。
    c课可以提交日志。
    b节点恢复，发现自己任期没有 c大。回滚日志，成为跟随者。
    raft ap